version: '2'

services:
  ldap:
    # https://github.com/osixia/docker-openldap
    image: osixia/openldap
    restart: unless-stopped
    # https://github.com/osixia/docker-openldap/tree/master/image/environment
    environment:
      # https://github.com/osixia/docker-openldap/issues/462
      LDAP_NOFILE: 8192
    volumes:
      - ldap-conf:/etc/ldap/slapd.d
      - ldap-data:/var/lib/ldap
      # https://github.com/osixia/docker-openldap#seed-ldap-database-with-ldif
      - ./import:/container/service/slapd/assets/config/bootstrap/ldif/custom:ro
    command: --copy-service
    ports:
      - 127.0.0.1:389:389
  ldap-admin:
    # https://github.com/osixia/docker-phpLDAPadmin
    image: osixia/phpldapadmin
    environment:
      PHPLDAPADMIN_LDAP_HOSTS: ldap
      PHPLDAPADMIN_HTTPS: false
    volumes:
      - ldapadmin-data:/var/www/phpldapadmin
    ports:
      - '127.0.0.1:8080:80'
    depends_on:
      - ldap
  ldap-cli:
    # https://github.com/osixia/docker-openldap
    image: osixia/openldap
    volumes:
      - ldap-conf:/etc/ldap/slapd.d
      - ldap-data:/var/lib/ldap
    # https://github.com/osixia/docker-light-baseimage#run-command-line-options
    entrypoint: /container/tool/run --loglevel warning --skip-env-files --skip-startup-files --skip-process-files --

volumes:
  ldap-conf:
  ldap-data:
  ldapadmin-data: